@page "/"
@inject NavigationManager Navigation

<PageTitle>Lost & Found - الرئيسية</PageTitle>

<div class="home-page">
    <!-- الهيدر الرئيسي -->
    <section class="hero-section">
        <div class="hero-overlay">
            <div class="hero-content">
                <h1 class="hero-title">Lost & Found</h1>
                <p class="hero-subtitle">منصة مجانية لمساعدة الناس في العثور على أغراضهم المفقودة</p>

                <!-- شريط البحث -->
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="ابحث عن هاتف، محفظة، مفاتيح..." />
                        <button class="search-btn" @onclick="NavigateToSearch">
                            <i class="fas fa-search"></i>
                            بحث
                        </button>
                    </div>
                </div>

                <!-- أزرار الإجراءات -->
                <div class="action-buttons">
                    <button class="btn btn-primary" @onclick="NavigateToReport">
                        <i class="fas fa-plus-circle"></i>
                        أضف بلاغ جديد
                    </button>
                    <button class="btn btn-secondary" @onclick="NavigateToSearch">
                        <i class="fas fa-list"></i>
                        تصفح البلاغات
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- قسم البلاغات الحديثة -->
    <section class="recent-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">آخر البلاغات</h2>
                <p class="section-subtitle">أحدث الإعلانات عن الأغراض المفقودة والمجدودة</p>
            </div>

            <!-- أزرار التصفية -->
            <div class="filter-tabs">
                <button class="filter-btn @(currentFilter == "all" ? "active" : "")"
                        @onclick='() => FilterItems("all")'>
                    الكل
                </button>
                <button class="filter-btn @(currentFilter == "lost" ? "active" : "")"
                        @onclick='() => FilterItems("lost")'>
                    مفقود
                </button>
                <button class="filter-btn @(currentFilter == "found" ? "active" : "")"
                        @onclick='() => FilterItems("found")'>
                    عُثر عليه
                </button>
            </div>

            <!-- شبكة البلاغات -->
            <div class="items-grid">
                @foreach (var item in filteredItems)
                {
                    <div class="item-card" @onclick="() => ViewItemDetails(item.Id)">
                        <div class="card-header">
                            <span class="item-type @item.Type">@item.TypeText</span>
                            <span class="item-status @item.Status">@item.StatusText</span>
                        </div>
                        <div class="card-image">
                            <img src="@item.ImageUrl" alt="@item.Title" />
                        </div>
                        <div class="card-body">
                            <h3 class="item-title">@item.Title</h3>
                            <div class="item-meta">
                                <span class="meta-item">
                                    <i class="fas fa-tag"></i>
                                    @item.Category
                                </span>
                                <span class="meta-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    @item.Location
                                </span>
                                <span class="meta-item">
                                    <i class="fas fa-calendar"></i>
                                    @item.Date
                                </span>
                            </div>
                            <p class="item-description">@item.Description</p>
                        </div>
                    </div>
                }
            </div>

            <!-- زر عرض المزيد -->
            <div class="view-more">
                <button class="btn btn-outline" @onclick="NavigateToSearch">
                    عرض جميع البلاغات
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- قسم الإحصائيات -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">@totalItems</div>
                        <div class="stat-label">بلاغ نشط</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">@resolvedItems</div>
                        <div class="stat-label">تم حلها</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">@activeUsers</div>
                        <div class="stat-label">مستخدم نشط</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

@code {
    private List<ItemModel> allItems = new();
    private List<ItemModel> filteredItems = new();
    private string currentFilter = "all";

    private int totalItems = 0;
    private int resolvedItems = 0;
    private int activeUsers = 150;

    protected override void OnInitialized()
    {
        LoadFakeData();
        FilterItems("all");
        CalculateStats();
    }

    private void LoadFakeData()
    {
        allItems = new List<ItemModel>
        {
            new ItemModel
            {
                Id = 1,
                Type = "lost",
                Title = "محفظة سوداء",
                Description = "محفظة جلدية سوداء تحتوي على بطاقات شخصية",
                Category = "محفظة",
                Location = "مركز المدينة",
                Date = "2024-01-15",
                Status = "active",
                ImageUrl = "/images/placeholder.jpg"
            },
            new ItemModel
            {
                Id = 2,
                Type = "found",
                Title = "هاتف آيفون",
                Description = "هاتف آيفون أسود في حافظة حمراء",
                Category = "هاتف",
                Location = "المجمع التجاري",
                Date = "2024-01-14",
                Status = "active",
                ImageUrl = "/images/placeholder.jpg"
            },
            new ItemModel
            {
                Id = 3,
                Type = "lost",
                Title = "مفاتيح سيارة",
                Description = "حزمة مفاتيح تحتوي على 5 مفاتيح",
                Category = "مفاتيح",
                Location = "موقف السيارات",
                Date = "2024-01-13",
                Status = "resolved",
                ImageUrl = "/images/placeholder.jpg"
            },
            new ItemModel
            {
                Id = 4,
                Type = "found",
                Title = "سماعات أذن",
                Description = "سماعات لاسلكية بيضاء",
                Category = "إلكترونيات",
                Location = "المكتبة",
                Date = "2024-01-12",
                Status = "active",
                ImageUrl = "/images/placeholder.jpg"
            }
        };
    }

    private void FilterItems(string filter)
    {
        currentFilter = filter;

        if (filter == "all")
        {
            filteredItems = allItems;
        }
        else if (filter == "lost")
        {
            filteredItems = allItems.Where(item => item.Type == "lost").ToList();
        }
        else if (filter == "found")
        {
            filteredItems = allItems.Where(item => item.Type == "found").ToList();
        }

        UpdateActiveFilterButtons();
        StateHasChanged();
    }

    private void UpdateActiveFilterButtons()
    {
        // هذا رح نضيفه بالـ JavaScript أو CSS classes
    }

    private void CalculateStats()
    {
        totalItems = allItems.Count;
        resolvedItems = allItems.Count(item => item.Status == "resolved");
    }

    private void NavigateToReport()
    {
        Navigation.NavigateTo("/report");
    }

    private void NavigateToSearch()
    {
        Navigation.NavigateTo("/search");
    }

    private void ViewItemDetails(int itemId)
    {
        Navigation.NavigateTo($"/item/{itemId}");
    }

    // نموذج البيانات
    private class ItemModel
    {
        public int Id { get; set; }
        public string Type { get; set; } = "lost";
        public string Title { get; set; } = "";
        public string Description { get; set; } = "";
        public string Category { get; set; } = "";
        public string Location { get; set; } = "";
        public string Date { get; set; } = "";
        public string Status { get; set; } = "active";
        public string ImageUrl { get; set; } = "/images/placeholder.jpg";

        public string TypeText => Type == "found" ? "عُثر عليه" : "مفقود";
        public string StatusText => Status == "resolved" ? "تم الاستلام" : "نشط";
    }
}