@page "/profile"
@inject NavigationManager Navigation

<PageTitle>Lost & Found - الملف الشخصي</PageTitle>

<div class="profile-page">
    <!-- هيدر الصفحة -->
    <section class="profile-header">
        <div class="container">
            <div class="header-content">
                <h1 class="page-title">الملف الشخصي</h1>
                <p class="page-subtitle">إدارة معلوماتك وبلاغاتك</p>
            </div>
        </div>
    </section>

    <!-- محتوى الصفحة -->
    <section class="profile-content">
        <div class="container">
            <div class="content-grid">
                <!-- الشريط الجانبي -->
                <aside class="profile-sidebar">
                    <div class="user-card">
                        <div class="user-avatar">
                            <img src="/images/avatar-placeholder.jpg" alt="صورة المستخدم" />
                        </div>
                        <div class="user-info">
                            <h3 class="user-name">أحمد محمد</h3>
                            <p class="user-email">ahmed@example.com</p>
                            <span class="user-badge user-role">مستخدم</span>
                        </div>
                    </div>

                    <nav class="profile-nav">
                        <a class="nav-item active">
                            <i class="fas fa-list"></i>
                            بلاغاتي
                        </a>
                        <a class="nav-item">
                            <i class="fas fa-user-edit"></i>
                            تعديل الملف
                        </a>
                        <a class="nav-item">
                            <i class="fas fa-cog"></i>
                            الإعدادات
                        </a>
                        <a class="nav-item">
                            <i class="fas fa-sign-out-alt"></i>
                            تسجيل الخروج
                        </a>
                    </nav>
                </aside>

                <!-- المحتوى الرئيسي -->
                <main class="profile-main">
                    <!-- إحصائيات سريعة -->
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">@userStats.TotalReports</div>
                                <div class="stat-label">إجمالي البلاغات</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">@userStats.ActiveReports</div>
                                <div class="stat-label">بلاغات نشطة</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number">@userStats.ResolvedReports</div>
                                <div class="stat-label">تم حلها</div>
                            </div>
                        </div>
                    </div>

                    <!-- تبويبات البلاغات -->
                    <div class="reports-tabs">
                        <button class="tab-btn @(activeTab == "all" ? "active" : "")"
                                @onclick='() => SwitchTab(" all")'>
                            جميع البلاغات
                        </button>
                        <button class="tab-btn @(activeTab == "lost" ? "active" : "")"
                                @onclick='() => SwitchTab(" lost")'>
                            مفقود
                        </button>
                        <button class="tab-btn @(activeTab == "found" ? "active" : "")"
                                @onclick='() => SwitchTab(" found")'>
                            عثر عليه
                        </button>
                    </div>

                    <!-- قائمة البلاغات -->
                    <div class="user-reports">
                        @if (filteredUserReports.Any())
                        {
                            @foreach (var report in filteredUserReports)
                            {
                                <div class="report-item">
                                    <div class="report-header">
                                        <h4 class="report-title">@report.Title</h4>
                                        <div class="report-meta">
                                            <span class="report-type @report.Type">@report.TypeText</span>
                                            <span class="report-status @report.Status">@report.StatusText</span>
                                            <span class="report-date">@report.Date</span>
                                        </div>
                                    </div>
                                    <div class="report-actions">
                                        <button class="btn btn-sm btn-outline" @onclick="() => ViewReport(report.Id)">
                                            <i class="fas fa-eye"></i>
                                            عرض
                                        </button>
                                        <button class="btn btn-sm btn-outline" @onclick="() => EditReport(report.Id)">
                                            <i class="fas fa-edit"></i>
                                            تعديل
                                        </button>
                                        <button class="btn btn-sm btn-danger" @onclick="() => DeleteReport(report.Id)">
                                            <i class="fas fa-trash"></i>
                                            حذف
                                        </button>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="no-reports">
                                <i class="fas fa-inbox"></i>
                                <h3>لا توجد بلاغات</h3>
                                <p>لم تقم بإضافة أي بلاغات بعد</p>
                                <button class="btn btn-primary" @onclick="NavigateToReport">
                                    <i class="fas fa-plus"></i>
                                    أضف أول بلاغ
                                </button>
                            </div>
                        }
                    </div>
                </main>
            </div>
        </div>
    </section>
</div>

@code {
    private string activeTab = "all";
    private List<UserReport> userReports = new();
    private List<UserReport> filteredUserReports = new();

    private UserStats userStats = new();

    protected override void OnInitialized()
    {
        LoadUserData();
        LoadUserReports();
        SwitchTab("all");
        CalculateStats();
    }

    private void LoadUserData()
    {
        // بيانات المستخدم الوهمية
    }

    private void LoadUserReports()
    {
        userReports = new List<UserReport>
        {
            new UserReport
            {
                Id = 1,
                Title = "محفظة سوداء",
                Type = "lost",
                Status = "active",
                Date = "2024-01-15"
            },
            new UserReport
            {
                Id = 2,
                Title = "هاتف آيفون",
                Type = "found",
                Status = "active",
                Date = "2024-01-14"
            },
            new UserReport
            {
                Id = 3,
                Title = "مفاتيح سيارة",
                Type = "lost",
                Status = "resolved",
                Date = "2024-01-13"
            }
        };
    }

    private void SwitchTab(string tab)
    {
        activeTab = tab;

        filteredUserReports = tab switch
        {
            "lost" => userReports.Where(r => r.Type == "lost").ToList(),
            "found" => userReports.Where(r => r.Type == "found").ToList(),
            _ => userReports
        };
    }

    private void CalculateStats()
    {
        userStats.TotalReports = userReports.Count;
        userStats.ActiveReports = userReports.Count(r => r.Status == "active");
        userStats.ResolvedReports = userReports.Count(r => r.Status == "resolved");
    }

    private void ViewReport(int reportId)
    {
        Navigation.NavigateTo($"/item/{reportId}");
    }

    private void EditReport(int reportId)
    {
        // نافذة تعديل البلاغ
    }

    private void DeleteReport(int reportId)
    {
        // تأكيد الحذف
    }

    private void NavigateToReport()
    {
        Navigation.NavigateTo("/report");
    }

    // نماذج البيانات
    private class UserReport
    {
        public int Id { get; set; }
        public string Title { get; set; } = "";
        public string Type { get; set; } = "lost";
        public string Status { get; set; } = "active";
        public string Date { get; set; } = "";

        public string TypeText => Type == "found" ? "عثر عليه" : "مفقود";
        public string StatusText => Status == "resolved" ? "تم الحل" : "نشط";
    }

    private class UserStats
    {
        public int TotalReports { get; set; }
        public int ActiveReports { get; set; }
        public int ResolvedReports { get; set; }
    }
}